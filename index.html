<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Bible Tracker App</title>
<link rel="manifest" href="manifest.webmanifest">
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#10B981">
<meta name="x-build" content="106">
<style>
  :root{--bg0:#f7f8fb;--bg1:#fff;--ink:#0f172a;--muted:#64748b;--ring:#e2e8f0;--card:#fff;--shadow:0 1px 2px rgba(0,0,0,.05)}
  [data-mode=dark]{--bg0:#0b1220;--bg1:#0b1220;--ink:#e5e7eb;--muted:#9aa6b2;--ring:#1f2937;--card:#0b1220;--shadow:0 1px 2px rgba(0,0,0,.2)}
  *{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg0);color:var(--ink)}
  header{position:sticky;top:0;z-index:50;border-bottom:1px solid transparent}
  .wrap{max-width:1040px;margin:0 auto;padding:16px}
  h1{margin:4px 0 0;font-size:clamp(20px,3vw,28px);color:#fff}
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-top:8px}
  .pill{display:flex;align-items:center;gap:8px;border:1px solid var(--ring);border-radius:999px;padding:6px 10px;background:var(--bg1);font-weight:700;font-size:14px;color:var(--ink)}
  [data-mode=dark] .pill{color:var(--ink)}
  select{background:transparent;border:none;font:inherit;color:inherit;font-weight:700}
  .btn{padding:6px 10px;border:1px solid var(--ring);border-radius:999px;background:var(--bg1);cursor:pointer;color:var(--ink)}
  .bar{height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden;margin-top:8px}
  [data-mode=dark] .bar{background:#111827}
  .bar>span{display:block;height:100%;transition:width .3s ease}
  main .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
  .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:14px;box-shadow:var(--shadow);cursor:pointer;transition:box-shadow .2s,transform .02s}
  .card:active{transform:scale(.995)}.card.done{opacity:.6}
  .k{font-size:12px;color:var(--muted)}.title{font-weight:600}
  .footer{text-align:center;color:var(--muted);font-size:12px;padding:18px 0 28px}
  .menu{position:relative}.menu-list{position:absolute;right:0;margin-top:8px;width:220px;border:1px solid var(--ring);border-radius:12px;background:var(--bg1);box-shadow:var(--shadow);overflow:hidden;z-index:100}
  .menu-list button,.menu-list label{display:block;width:100%;text-align:left;padding:8px 10px;border:0;background:transparent;font:inherit;color:inherit;cursor:pointer}
  .menu-sep{height:1px;background:var(--ring);margin:4px 0}
  .hidden-input{position:absolute;opacity:0;width:0;height:0}
  .header-line{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .progress-row{display:flex;justify-content:space-between;align-items:center;font-size:14px;font-weight:700;color:#fff;text-shadow:0 1px 1px rgba(0,0,0,.5);margin-top:6px}
  .filter-row{display:grid;grid-template-columns:1fr 2fr;gap:12px}
  @media (min-width:768px){.filter-row{grid-template-columns:1fr 2fr}}
  .section-header{grid-column:1/-1;border:1px solid var(--ring);border-radius:16px;padding:10px 12px;background:var(--bg1);display:flex;justify-content:space-between;align-items:center;cursor:pointer;box-shadow:var(--shadow)}
  a.link{text-decoration:none}
</style>
</head>
<body data-mode="light" data-theme="emerald">
<header id="appHeader" style="background:linear-gradient(135deg,#10B981 0%,#047857 55%,#064e3b 100%);transform:translateZ(0)">
  <div class="wrap">
    <div class="header-line">
      <h1>Bible Tracker App</h1>
      <div class="controls">
        <div class="pill"><span>Scope</span>
          <select id="scope"><option>All</option><option>OT</option><option>NT</option></select>
        </div>
        <div class="pill"><span>Translation</span>
          <select id="translation"><option>ESV</option><option>CSB</option><option>NIV</option><option>KJV</option><option>NASB</option></select>
        </div>
        <div class="menu" id="moreWrap">
          <button class="btn" id="more" title="Settings">⚙️</button>
          <div class="menu-list" id="menu" hidden>
            <div class="k" style="padding:6px 10px">Theme</div>
            <div style="padding:0 10px 6px">
              <select id="theme" style="width:100%;display:block;border:1px solid var(--ring);border-radius:8px;padding:8px;background:var(--bg1);color:var(--ink)">
                <option value="emerald">Emerald</option>
                <option value="indigo">Indigo</option>
                <option value="rose">Rose</option>
                <option value="red">Red</option>
                <option value="sky">Sky</option>
                <option value="amber">Amber</option>
                <option value="violet">Violet</option>
                <option value="teal">Teal</option>
                <option value="slate">Slate</option>
                <option value="gray">Gray</option>
                <option value="zinc">Zinc</option>
                <option value="neutral">Neutral</option>
                <option value="stone">Stone</option>
              </select>
            </div>
            <div class="menu-sep"></div>
            <button id="toggleMode">Switch to Dark Mode</button>
            <div class="menu-sep"></div>
            <button id="export">Export</button>
            <label>Import
              <input id="import" type="file" accept=".json" class="hidden-input">
            </label>
            <div class="menu-sep"></div>
            <button id="reset" style="color:#b91c1c">Reset</button>
          </div>
        </div>
      </div>
    </div>
    <div class="bar"><span id="progress" style="background:#047857;width:0%"></span></div>
    <div class="progress-row">
      <span id="completed">0 / 1189 completed</span>
      <span id="meta">0% • ESV • All</span>
    </div>
  </div>
</header>
<main class="wrap">
  <div class="card" style="border-color:var(--ring)">
    <div class="title" style="margin-bottom:10px">Browse &amp; Filter</div>
    <div class="filter-row">
      <div class="flex">
        <label class="k" for="book">Book</label>
        <select id="book" style="width:100%;display:block;border:1px solid var(--ring);border-radius:8px;padding:8px;background:var(--bg1);color:var(--ink);margin-left:10px"></select>
      </div>
      <div class="flex">
        <label class="k" for="q">Search</label>
        <input id="q" placeholder="Try 'John 3' or a chapter number" style="width:100%;display:block;border:1px solid var(--ring);border-radius:8px;padding:8px;background:var(--bg1);color:var(--ink);margin-left:10px">
      </div>
    </div>
    <div style="margin-top:10px"><button class="btn" id="showAll">Show All</button></div>
  </div>
  <div id="list" class="grid"></div>
  <div class="footer">Bible Tracker App • v1.0.6</div>
</main>
<script>
const OT_BOOKS=[["Genesis",50],["Exodus",40],["Leviticus",27],["Numbers",36],["Deuteronomy",34],["Joshua",24],["Judges",21],["Ruth",4],["1 Samuel",31],["2 Samuel",24],["1 Kings",22],["2 Kings",25],["1 Chronicles",29],["2 Chronicles",36],["Ezra",10],["Nehemiah",13],["Esther",10],["Job",42],["Psalms",150],["Proverbs",31],["Ecclesiastes",12],["Song of Songs",8],["Isaiah",66],["Jeremiah",52],["Lamentations",5],["Ezekiel",48],["Daniel",12],["Hosea",14],["Joel",3],["Amos",9],["Obadiah",1],["Jonah",4],["Micah",7],["Nahum",3],["Habakkuk",3],["Zephaniah",3],["Haggai",2],["Zechariah",14],["Malachi",4]];
const NT_BOOKS=[["Matthew",28],["Mark",16],["Luke",24],["John",21],["Acts",28],["Romans",16],["1 Corinthians",16],["2 Corinthians",13],["Galatians",6],["Ephesians",6],["Philippians",4],["Colossians",4],["1 Thessalonians",5],["2 Thessalonians",3],["1 Timothy",6],["2 Timothy",4],["Titus",3],["Philemon",1],["Hebrews",13],["James",5],["1 Peter",5],["2 Peter",3],["1 John",5],["2 John",1],["3 John",1],["Jude",1],["Revelation",22]];
const PSALM_SECTIONS=[{label:"Psalms 1–41",start:1,end:41},{label:"Psalms 42–72",start:42,end:72},{label:"Psalms 73–89",start:73,end:89},{label:"Psalms 90–106",start:90,end:106},{label:"Psalms 107–150",start:107,end:150}];
function buildWhole(){const out=[];let id=1;for(const [b,n] of OT_BOOKS){for(let c=1;c<=n;c++){out.push({id,t:"OT",book:b,chapter:c,passage:`${b} ${c}`,done:false});id++;}}for(const [b,n] of NT_BOOKS){for(let c=1;c<=n;c++){out.push({id,t:"NT",book:b,chapter:c,passage:`${b} ${c}`,done:false});id++;}}return out;}
const STORAGE_KEY="bta_whole_v3",PREF_MODE="bta_mode_v3",PREF_THEME="bta_theme_v3",PREF_TRANS="bta_translation_v3",PREF_SCOPE="bta_scope_v3",PREF_BOOK="bta_book_v3";
let plan=null;try{plan=JSON.parse(localStorage.getItem(STORAGE_KEY)||"null");}catch(e){plan=null;}
if(!Array.isArray(plan)||plan.length!==1189)plan=buildWhole();
const $=id=>document.getElementById(id);
document.body.dataset.mode=localStorage.getItem(PREF_MODE)||"light";
document.body.dataset.theme=localStorage.getItem(PREF_THEME)||"emerald";
$("translation").value=localStorage.getItem(PREF_TRANS)||"ESV";
$("scope").value=localStorage.getItem(PREF_SCOPE)||"All";
$("q").value="";let savedBook=localStorage.getItem(PREF_BOOK)||"All";$("theme").value=document.body.dataset.theme;
const gradientMap={emerald:["#10B981","#047857","#064e3b"],indigo:["#6366F1","#4338CA","#312E81"],rose:["#F43F5E","#BE123C","#881337"],red:["#EF4444","#B91C1C","#7F1D1D"],sky:["#0EA5E9","#0369A1","#0C4A6E"],amber:["#F59E0B","#B45309","#78350F"],violet:["#8B5CF6","#6D28D9","#4C1D95"],teal:["#14B8A6","#0F766E","#115E59"],slate:["#64748B","#334155","#1F2937"],gray:["#6B7280","#374151","#111827"],zinc:["#71717A","#3F3F46","#18181B"],neutral:["#737373","#404040","#171717"],stone:["#78716C","#44403C","#1C1917"]};
function applyThemeChrome(){const th=document.body.dataset.theme;const [a,b,c]=gradientMap[th]||gradientMap.emerald;document.querySelector('meta[name="theme-color"]').setAttribute('content',a);$("appHeader").style.background=`linear-gradient(135deg, ${a} 0%, ${b} 55%, ${c} 100%)`;$("progress").style.background=b;}
applyThemeChrome();
function inScopeItems(){const scope=$("scope").value;return plan.filter(p=>scope==="All"?true:p.t===scope);}
function computeProgress(){const inScope=inScopeItems();const done=inScope.filter(p=>p.done).length;const total=inScope.length;const pct=Math.round(done/total*100)||0;$("progress").style.width=pct+"%";$("completed").textContent=`${done} / ${total} completed`;$("meta").textContent=`${pct}% • ${$("translation").value} • ${$("scope").value}`;}
function computeBooksGroups(){const inScope=inScopeItems();const totals=new Map(),done=new Map();for(const p of inScope){totals.set(p.book,(totals.get(p.book)||0)+1);if(p.done)done.set(p.book,(done.get(p.book)||0)+1);}const order=Array.from(new Set(inScope.map(p=>p.book)));const remaining=[],completed=[];for(const b of order){const t=totals.get(b)||0,d=done.get(b)||0;if(t>0&&d===t)completed.push(b);else remaining.push(b);}return{remaining,completed};}
function makeCard(item){const div=document.createElement("div");div.className="card"+(item.done?" done":"");div.setAttribute("role","button");div.setAttribute("tabindex","0");div.onclick=(e)=>{e.stopPropagation();item.done=!item.done;save();render();};div.onkeydown=e=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();e.stopPropagation();item.done=!item.done;save();render();}};const top=document.createElement("div");top.style.display="flex";top.style.justifyContent="space-between";top.style.alignItems="flex-start";top.style.gap="8px";const left=document.createElement("div");const h=document.createElement("div");h.className="title";h.textContent=item.passage;const k=document.createElement("div");k.className="k";k.textContent=item.t==="OT"?"Old Testament":"New Testament";left.appendChild(h);left.appendChild(k);const right=document.createElement("div");if(item.done){const mark=document.createElement("div");mark.textContent="✓";mark.style.fontWeight="700";right.appendChild(mark);}const linkRow=document.createElement("div");linkRow.className="k";linkRow.style.marginTop="6px";const a=document.createElement("a");a.className="link";a.href="https://www.biblegateway.com/passage/?search="+encodeURIComponent(item.passage)+"&version="+encodeURIComponent($("translation").value);a.target="_blank";a.textContent="Read ("+$("translation").value+")";a.onclick=e=>{e.stopPropagation();};linkRow.appendChild(a);div.appendChild(top);top.appendChild(left);top.appendChild(right);div.appendChild(linkRow);return div;}
function renderBooksDropdown(){const sel=$("book");sel.innerHTML="";const optAll=document.createElement("option");optAll.value="All";optAll.textContent="All";sel.appendChild(optAll);const {remaining,completed}=computeBooksGroups();if(remaining.length){const g=document.createElement("optgroup");g.label="Books";remaining.forEach(b=>{const o=document.createElement("option");o.value=b;o.textContent=b;g.appendChild(o);});sel.appendChild(g);}if(completed.length){const g=document.createElement("optgroup");g.label="Completed";completed.forEach(b=>{const o=document.createElement("option");o.value=b;o.textContent="✓ "+b;g.appendChild(o);});sel.appendChild(g);}sel.value=savedBook;}
function filteredItems(){const scopeItems=inScopeItems();const book=$("book").value;const q=$("q").value.trim().toLowerCase();return scopeItems.filter(p=>{const okBook=book==="All"||p.book===book;const okQuery=!q||p.passage.toLowerCase().includes(q)||String(p.chapter).includes(q);return okBook&&okQuery;});}
function render(){computeProgress();renderBooksDropdown();const list=$("list");list.innerHTML="";const items=filteredItems();const book=$("book").value;const q=$("q").value.trim();if(book==="Psalms"&&q===""){for(let i=0;i<PSALM_SECTIONS.length;i++){const sec=PSALM_SECTIONS[i];const head=document.createElement("div");head.className="section-header";head.innerHTML=`<span class="title">${sec.label}</span><span class="k">▸</span>`;list.appendChild(head);let open=false;head.onclick=()=>{open=!open;head.lastChild.textContent=open?"▾":"▸";renderSection(i,open);};head.onkeydown=(e)=>{if(e.key==="Enter"||e.key===" "){e.preventDefault();open=!open;head.lastChild.textContent=open?"▾":"▸";renderSection(i,open);}};function renderSection(idx,openNow){const siblings=[...list.querySelectorAll(`[data-sec="${idx}"]`)];siblings.forEach(n=>n.remove());if(!openNow)return;const wrapper=document.createElement("div");wrapper.setAttribute("data-sec",String(idx));wrapper.onclick=(e)=>e.stopPropagation();wrapper.onkeydown=(e)=>{ if(e.key==='Enter'||e.key===' '){ e.stopPropagation(); } };const secItems=items.filter(it=>it.book==="Psalms"&&it.chapter>=sec.start&&it.chapter<=sec.end);for(const it of secItems){const card=makeCard(it);wrapper.appendChild(card);}list.appendChild(wrapper);}}}else{for(const it of items){list.appendChild(makeCard(it));}if(!items.length){const empty=document.createElement("div");empty.className="k";empty.style.gridColumn="1/-1";empty.style.textAlign="center";empty.style.padding="16px 0";empty.textContent="No results. Try clearing the search or changing the book.";list.appendChild(empty);}}}
function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(plan));}
$("scope").onchange=()=>{localStorage.setItem(PREF_SCOPE,$("scope").value);savedBook="All";localStorage.setItem(PREF_BOOK,"All");window.scrollTo({top:0,behavior:"smooth"});render();};
$("translation").onchange=()=>{localStorage.setItem(PREF_TRANS,$("translation").value);render();};
$("book").onchange=()=>{savedBook=$("book").value;localStorage.setItem(PREF_BOOK,$("book").value);window.scrollTo({top:0,behavior:"smooth"});render();};
$("q").oninput=()=>render();
$("showAll").onclick=()=>{ $("book").value="All"; savedBook="All"; localStorage.setItem(PREF_BOOK,"All"); render(); };
const menu=$("menu"),more=$("more"),moreWrap=$("moreWrap"),themeSel=$("theme");
more.onclick=e=>{e.stopPropagation();menu.hidden=!menu.hidden;};
document.addEventListener("click",e=>{if(!moreWrap.contains(e.target))menu.hidden=true;});
themeSel.onchange=()=>{document.body.dataset.theme=themeSel.value;localStorage.setItem(PREF_THEME,themeSel.value);applyThemeChrome();menu.hidden=true;};
$("toggleMode").onclick=()=>{document.body.dataset.mode=document.body.dataset.mode==="dark"?"light":"dark";localStorage.setItem(PREF_MODE,document.body.dataset.mode);$("toggleMode").textContent=document.body.dataset.mode==="dark"?"Switch to Light Mode":"Switch to Dark Mode";};
$("export").onclick=()=>{const blob=new Blob([JSON.stringify({plan},null,2)],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="bible-reading-progress.json";a.click();URL.revokeObjectURL(url);};
$("import").onchange=async e=>{const f=e.target.files&&e.target.files[0];if(!f)return;try{const text=await f.text();const data=JSON.parse(text);if(data.plan&&Array.isArray(data.plan)){plan=data.plan.map((p,i)=>({id:p.id??i+1,t:p.t||(/^(Matthew|Mark|Luke|John|Acts|Romans|1 Corinthians|2 Corinthians|Galatians|Ephesians|Philippians|Colossians|1 Thessalonians|2 Thessalonians|1 Timothy|2 Timothy|Titus|Philemon|Hebrews|James|1 Peter|2 Peter|1 John|2 John|3 John|Jude|Revelation)$/.test(p.book)?"NT":"OT"),book:p.book,chapter:p.chapter,passage:p.passage||p.book+" "+p.chapter,done:!!p.done}));save();render();}}catch(err){alert("Invalid file.");}finally{e.target.value="";}};
$("reset").onclick=()=>{if(!confirm("Reset all checkboxes?"))return;for(const it of plan)it.done=false;save();render();};
if(localStorage.getItem(PREF_MODE)==="dark"){document.body.dataset.mode="dark";$("toggleMode").textContent="Switch to Light Mode";}
render();applyThemeChrome();
if("serviceWorker"in navigator){window.addEventListener("load",async()=>{try{const reg=await navigator.serviceWorker.register("./sw-v10.js");if(reg.waiting)reg.waiting.postMessage({type:"SKIP_WAITING"});if(reg.installing){reg.installing.addEventListener("statechange",e=>{if(e.target.state==="installed")location.reload();});}let refreshing=false;navigator.serviceWorker.addEventListener("controllerchange",()=>{if(refreshing)return;refreshing=true;location.reload();});}catch(_){}});}
</script>
</body>
</html>
