<!DOCTYPE html>
<html lang="en" data-mode="light" data-theme="emerald">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="manifest" href="manifest.webmanifest">
<link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
<meta name="theme-color" content="#10b981">
<title>Bible Tracker App</title>
<style>
  :root { --bg0:#f7f8fb; --bg1:#ffffff; --ink:#0f172a; --muted:#64748b; --ring:#e2e8f0;
          --card:#ffffff; --shadow:0 1px 2px rgba(0,0,0,.04); --accent:#10b981; --accent-ink:#ffffff; --link:#059669; }
  html[data-theme="indigo"] { --accent:#6366f1; --link:#4f46e5; }
  html[data-theme="rose"]   { --accent:#f43f5e; --link:#e11d48; }
  html[data-mode="dark"]    { --bg0:#0b1220; --bg1:#0b1220; --ink:#e5e7eb; --muted:#94a3b8; --ring:#1f2937; --card:#0b1220; --shadow:0 1px 2px rgba(0,0,0,.2); }
  * { box-sizing:border-box; } body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:var(--bg0); color:var(--ink); }
  header { position:sticky; top:0; background: rgba(255,255,255,.86); border-bottom:1px solid var(--ring); backdrop-filter: saturate(1.2) blur(8px); }
  html[data-mode="dark"] header { background: rgba(11,18,32,.86); }
  .wrap { max-width:1040px; margin:0 auto; padding:16px; } h1 { margin:6px 0 2px; font-size: clamp(20px, 3vw, 28px); }
  .muted { color:var(--muted); font-size:14px; } .controls { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; align-items:center; }
  select, button, input { font: inherit; } .select, .btn, .pill, input[type="search"] { border:1px solid var(--ring); background:var(--bg1); color:var(--ink); }
  .btn { padding:8px 12px; border-radius:999px; cursor:pointer; } .pill { border-radius:999px; padding:6px 10px; font-size:12px; }
  .select { border-radius:12px; padding:6px 10px; } input[type="search"] { border-radius:12px; padding:8px 12px; flex:1; min-width:220px; }
  .row{display:flex;gap:10px;align-items:center;} .bar{height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden;}
  html[data-mode="dark"] .bar{background:#111827;} .bar>span{display:block;height:100%;background: var(--accent); width:0; transition: width .3s ease;}
  main .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px;}
  .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:14px;display:flex;align-items:center;gap:12px;box-shadow:var(--shadow);}
  .card.done{opacity:.6;} .grow{flex:1;line-height:1.35;} .strike{text-decoration:line-through;color:var(--muted);}
  a.link{color:var(--link);text-decoration:none;} a.link:hover{text-decoration:underline;} .k{font-size:12px;color:var(--muted);}
  .hidden-input{position:absolute;opacity:0;width:0;height:0;} .footer{text-align:center;color:var(--muted);font-size:12px;padding:18px 0 28px;}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Bible Tracker App</h1>
    <div class="muted">Whole Bible • Free selection • Progress saved locally</div>

    <div class="controls">
      <label class="pill">Scope
        <select id="scope" class="select" style="margin-left:6px">
          <option value="All">All</option>
          <option value="OT">Old Testament</option>
          <option value="NT">New Testament</option>
        </select>
      </label>

      <label class="pill">Book
        <select id="jump" class="select" style="margin-left:6px">
          <option value="All">All</option>
        </select>
      </label>

      <input id="q" type="search" placeholder="Search: John 3, 'Genesis', or a chapter number…">

      <div class="pill">Theme
        <select id="theme" class="select" style="margin-left:6px">
          <option value="emerald">Emerald</option>
          <option value="indigo">Indigo</option>
          <option value="rose">Rose</option>
        </select>
      </div>

      <div class="pill">Translation
        <select id="translation" class="select" style="margin-left:6px">
          <option value="ESV">ESV</option>
          <option value="CSB">CSB</option>
          <option value="NIV">NIV</option>
          <option value="KJV">KJV</option>
          <option value="NASB">NASB</option>
        </select>
      </div>

      <button id="mode" class="btn">🌙 Dark</button>
      <button id="export" class="btn">Export</button>
      <label class="btn">Import<input id="import" type="file" accept=".json" class="hidden-input"></label>
      <button id="reset" class="btn">Reset</button>
    </div>

    <div class="row" style="margin-top:10px">
      <div class="bar" style="flex:1"><span id="progress"></span></div>
      <div class="muted" id="pct" style="min-width:220px;text-align:right">0% • 0 / 1189 • ESV • All</div>
    </div>
  </div>
</header>

<main class="wrap">
  <div id="list" class="grid" aria-live="polite"></div>
  <div class="footer">PWA • Works offline • Use Safari → Add to Home Screen</div>
</main>

<script>
const OT_BOOKS = [["Genesis",50],["Exodus",40],["Leviticus",27],["Numbers",36],["Deuteronomy",34],["Joshua",24],["Judges",21],["Ruth",4],["1 Samuel",31],["2 Samuel",24],["1 Kings",22],["2 Kings",25],["1 Chronicles",29],["2 Chronicles",36],["Ezra",10],["Nehemiah",13],["Esther",10],["Job",42],["Psalms",150],["Proverbs",31],["Ecclesiastes",12],["Song of Songs",8],["Isaiah",66],["Jeremiah",52],["Lamentations",5],["Ezekiel",48],["Daniel",12],["Hosea",14],["Joel",3],["Amos",9],["Obadiah",1],["Jonah",4],["Micah",7],["Nahum",3],["Habakkuk",3],["Zephaniah",3],["Haggai",2],["Zechariah",14],["Malachi",4]];
const NT_BOOKS = [["Matthew",28],["Mark",16],["Luke",24],["John",21],["Acts",28],["Romans",16],["1 Corinthians",16],["2 Corinthians",13],["Galatians",6],["Ephesians",6],["Philippians",4],["Colossians",4],["1 Thessalonians",5],["2 Thessalonians",3],["1 Timothy",6],["2 Timothy",4],["Titus",3],["Philemon",1],["Hebrews",13],["James",5],["1 Peter",5],["2 Peter",3],["1 John",5],["2 John",1],["3 John",1],["Jude",1],["Revelation",22]];

const STORAGE_KEY = "bta_whole_v1";
const PREF_MODE  = "bta_mode_v1";
const PREF_THEME = "bta_theme_v1";
const PREF_TRANS = "bta_translation_v1";
const PREF_SCOPE = "bta_scope_v1";

function buildWhole(){
  const out=[]; let id=1;
  for (const [book, chapters] of OT_BOOKS){ for (let c=1;c<=chapters;c++){ out.push({id, t:"OT", book, chapter:c, done:false}); id++; } }
  for (const [book, chapters] of NT_BOOKS){ for (let c=1;c<=chapters;c++){ out.push({id, t:"NT", book, chapter:c, done:false}); id++; } }
  return out;
}
let plan=null; try{ plan=JSON.parse(localStorage.getItem(STORAGE_KEY)||"null"); }catch(e){ plan=null; }
if(!Array.isArray(plan)||plan.length!==1189) plan=buildWhole();

document.documentElement.dataset.mode  = localStorage.getItem(PREF_MODE)  || "light";
document.documentElement.dataset.theme = localStorage.getItem(PREF_THEME) || "emerald";
document.getElementById("theme").value = document.documentElement.dataset.theme;
document.getElementById("translation").value = localStorage.getItem(PREF_TRANS) || "ESV";
document.getElementById("scope").value = localStorage.getItem(PREF_SCOPE) || "All";

function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(plan)); }
function updateProgress(){
  const scope=document.getElementById("scope").value;
  const trans=document.getElementById("translation").value;
  const inScope=plan.filter(p=>scope==="All" ? true : (p.t===scope));
  const done=inScope.filter(p=>p.done).length;
  const total=inScope.length;
  const pct=Math.round(done/total*100)||0;
  document.getElementById("progress").style.width = pct + "%";
  document.getElementById("pct").textContent = pct + "% • " + done + " / " + total + " • " + trans + " • " + scope;
}
function makeCard(item){
  const card=document.createElement("div"); card.className="card"; if(item.done) card.classList.add("done");
  const chk=document.createElement("input"); chk.type="checkbox"; chk.checked=item.done;
  const wrap=document.createElement("div"); wrap.className="grow";
  const title=document.createElement("div"); title.innerHTML = "<strong>"+item.book+" "+item.chapter+"</strong>";
  if(item.done) title.classList.add("strike");
  const meta=document.createElement("div"); meta.className="k"; meta.textContent = item.t==="OT"?"Old Testament":"New Testament";
  const right=document.createElement("div"); const a=document.createElement("a");
  a.className="link k"; a.target="_blank"; a.textContent="Read";
  const trans=document.getElementById("translation").value;
  a.href="https://www.biblegateway.com/passage/?search="+encodeURIComponent(item.book+" "+item.chapter)+"&version="+encodeURIComponent(trans);
  right.appendChild(a);
  wrap.appendChild(title); wrap.appendChild(meta);
  card.appendChild(chk); card.appendChild(wrap); card.appendChild(right);
  chk.onchange=()=>{ item.done=chk.checked; save(); card.classList.toggle("done", item.done); title.classList.toggle("strike", item.done); updateProgress(); };
  return card;
}
function render(){
  const list=document.getElementById("list"); list.innerHTML="";
  const q=document.getElementById("q").value.trim().toLowerCase();
  const scope=document.getElementById("scope").value;
  const bookFilter=document.getElementById("jump").value;
  const frag=document.createDocumentFragment();
  for(const it of plan){
    if(scope!=="All" && it.t!==scope) continue;
    if(bookFilter!=="All" && it.book!==bookFilter) continue;
    if(q){
      const label=(it.book+" "+it.chapter).toLowerCase();
      const hit = label.includes(q) || it.book.toLowerCase().includes(q) || String(it.chapter).includes(q);
      if(!hit) continue;
    }
    frag.appendChild(makeCard(it));
  }
  list.appendChild(frag);
  updateProgress();
}
function renderBooks(){
  const scope=document.getElementById("scope").value;
  const jump=document.getElementById("jump"); jump.innerHTML="";
  const optAll=document.createElement("option"); optAll.value="All"; optAll.textContent="All"; jump.appendChild(optAll);
  const set=new Set();
  for(const it of plan){ if(scope==="All"||it.t===scope) set.add(it.book); }
  for(const b of Array.from(set)) { const o=document.createElement("option"); o.value=b; o.textContent=b; jump.appendChild(o); }
}
renderBooks(); render();

document.getElementById("q").oninput=render;
document.getElementById("scope").onchange=()=>{ localStorage.setItem(PREF_SCOPE, document.getElementById("scope").value); renderBooks(); render(); };
document.getElementById("jump").onchange=render;
document.getElementById("theme").onchange=()=>{ const v=document.getElementById("theme").value; document.documentElement.dataset.theme=v; localStorage.setItem(PREF_THEME, v); };
document.getElementById("translation").onchange=()=>{ localStorage.setItem(PREF_TRANS, document.getElementById("translation").value); render(); };
document.getElementById("mode").onclick=()=>{ const cur=document.documentElement.dataset.mode||"light"; const next=cur==="light"?"dark":"light"; document.documentElement.dataset.mode=next; localStorage.setItem(PREF_MODE, next); document.getElementById("mode").textContent = next==="dark"?"☀️ Light":"🌙 Dark"; };
document.getElementById("reset").onclick=()=>{ if(!confirm("Reset all checkboxes?")) return; for(const it of plan) it.done=false; save(); render(); };
document.getElementById("export").onclick=()=>{ const blob=new Blob([JSON.stringify({plan}, null, 2)], {type:"application/json"}); const url=URL.createObjectURL(blob); const a=document.createElement("a"); a.href=url; a.download="bible-reading-progress.json"; a.click(); URL.revokeObjectURL(url); };
document.getElementById("import").onchange=async (e)=>{ const f=e.target.files&&e.target.files[0]; if(!f) return; try{ const text=await f.text(); const data=JSON.parse(text); if(data.plan&&Array.isArray(data.plan)) plan=data.plan; save(); render(); }catch(err){ alert("Invalid file."); } finally { e.target.value=""; } };

if ("serviceWorker" in navigator) { window.addEventListener("load", () => { navigator.serviceWorker.register("./sw.js"); }); }
</script>
</body>
</html>
